<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Resource hints for faster loading -->
  <link rel="preconnect" href="https://www.googletagmanager.com">
  <link rel="preconnect" href="https://www.gstatic.com">
  <link rel="dns-prefetch" href="https://www.googletagmanager.com">
  <link rel="dns-prefetch" href="https://www.gstatic.com">
  
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-7X5LQ6WESD"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-7X5LQ6WESD');
</script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- Primary Meta Tags -->
  <meta name="description" content="Watch live cricket scores with real-time ball-by-ball updates. Follow ongoing matches, view over-by-over analysis, and track runs, wickets, and player performance live. Free cricket scoring app.">
  <meta name="keywords" content="live cricket score, cricket live score, live cricket match, cricket score ball by ball, real-time cricket score, cricket scoring app, cricket match tracker, live cricket updates, cricket scoreboard, cricket score online, watch cricket live, cricket match online, cricket scoring software, digital cricket scorer">
  <meta name="author" content="CricketBook">
  <meta name="robots" content="index, follow">
  <meta name="language" content="English">
  <meta name="revisit-after" content="1 days">
  <meta name="theme-color" content="#667eea">
  <link rel="canonical" href="https://cricketbook.digital/livescore.html">
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://cricketbook.digital/livescore.html">
  <meta property="og:title" content="Live Cricket Score - Real-Time Match Updates | CricketBook">
  <meta property="og:description" content="Watch live cricket scores with real-time ball-by-ball updates. Follow ongoing matches with detailed over-by-over analysis and live statistics.">
  <meta property="og:image" content="https://cricketbook.digital/og-image-livescore.png">
  <meta property="og:site_name" content="CricketBook">
  <meta property="og:locale" content="en_US">
  
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:url" content="https://cricketbook.digital/livescore.html">
  <meta name="twitter:title" content="Live Cricket Score - Real-Time Match Updates | CricketBook">
  <meta name="twitter:description" content="Watch live cricket scores with real-time ball-by-ball updates. Follow ongoing matches with detailed over-by-over analysis.">
  <meta name="twitter:image" content="https://cricketbook.digital/twitter-image-livescore.png">
  <meta name="twitter:site" content="@cricketbook">
  
  <!-- Additional SEO -->
  <meta name="rating" content="General">
  <meta name="distribution" content="Global">
  <meta name="coverage" content="Worldwide">
  <meta name="target" content="all">
  <meta name="audience" content="Cricket players, coaches, teams, tournament organizers, cricket fans">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="CricketBook Live">
  
  <link rel="manifest" href="manifest.json">
  <title id="pageTitle">Live Cricket Score - Real-Time Match Updates | CricketBook</title>
  
  <!-- Structured Data / JSON-LD -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "CricketBook Live Score",
    "url": "https://cricketbook.digital/livescore.html",
    "description": "Real-time cricket live scoring application with ball-by-ball updates, match statistics, and detailed scoreboard tracking.",
    "applicationCategory": "SportsApplication",
    "operatingSystem": "Web, iOS, Android",
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "USD"
    },
    "author": {
      "@type": "Organization",
      "name": "CricketBook",
      "url": "https://cricketbook.digital"
    },
    "publisher": {
      "@type": "Organization",
      "name": "CricketBook",
      "logo": {
        "@type": "ImageObject",
        "url": "https://cricketbook.digital/logo.png"
      }
    },
    "inLanguage": "en",
    "potentialAction": {
      "@type": "UseAction",
      "target": {
        "@type": "EntryPoint",
        "urlTemplate": "https://cricketbook.digital/livescore.html",
        "actionPlatform": [
          "http://schema.org/DesktopWebPlatform",
          "http://schema.org/MobileWebPlatform",
          "http://schema.org/IOSPlatform",
          "http://schema.org/AndroidPlatform"
        ]
      }
    }
  }
  </script>
  <style>
    :root {
      /* Light mode (default) */
      --bg-gradient-start: #667eea;
      --bg-gradient-end: #764ba2;
      --card-bg: #ffffff;
      --card-border: rgba(148,163,184,.2);
      --text-primary: #1f2937;
      --text-secondary: #6b7280;
      --text-tertiary: #94a3b8;
      --nav-text: #ffffff;
      --badge-bg: rgba(255, 255, 255, 0.15);
      --badge-border: rgba(255, 255, 255, 0.1);
      --badge-hover: rgba(255, 255, 255, 0.25);
      --table-bg: #f8fafc;
      --table-border: #e2e8f0;
      --empty-bg: #ffffff;
      --error-bg: #fef2f2;
      --error-border: #fecaca;
      --error-text: #991b1b;
    }
    
    [data-theme="dark"] {
      /* Dark mode */
      --bg-gradient-start: #1e293b;
      --bg-gradient-end: #0f172a;
      --card-bg: #1e293b;
      --card-border: rgba(71,85,105,.3);
      --text-primary: #f1f5f9;
      --text-secondary: #cbd5e1;
      --text-tertiary: #64748b;
      --nav-text: #f1f5f9;
      --badge-bg: rgba(255, 255, 255, 0.1);
      --badge-border: rgba(255, 255, 255, 0.05);
      --badge-hover: rgba(255, 255, 255, 0.2);
      --table-bg: #0f172a;
      --table-border: #334155;
      --empty-bg: #1e293b;
      --error-bg: #450a0a;
      --error-border: #7f1d1d;
      --error-text: #fca5a5;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
      min-height: 100vh;
      padding: 18px;
      color: var(--text-primary);
      transition: background 0.3s ease, color 0.3s ease;
    }
    
    .container {
      max-width: 480px;
      margin: 0 auto;
    }
    
    .card {
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 20px;
      padding: 24px;
      box-shadow: 0 10px 40px rgba(0,0,0,.12), 0 2px 8px rgba(0,0,0,.08);
      position: relative;
      color: var(--text-primary);
      transition: background 0.3s ease, border-color 0.3s ease, color 0.3s ease;
    }
    
    .result-banner {
      background: linear-gradient(135deg, #10b981 0%, #3b82f6 100%);
      color: white;
      border-radius: 12px;
      padding: 16px;
      text-align: center;
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 12px;
      box-shadow: 0 4px 12px rgba(16,185,129,0.3);
      display: none;
    }
    
    .result-banner.show {
      display: block;
    }
    
    .loading {
      text-align: center;
      color: var(--nav-text);
      font-size: 18px;
      padding: 40px;
    }
    
    .error {
      background: var(--error-bg);
      border: 1px solid var(--error-border);
      color: var(--error-text);
      padding: 16px;
      border-radius: 12px;
      text-align: center;
      margin-top: 20px;
      transition: all 0.3s ease;
    }
    
    .empty-state {
      background: var(--empty-bg);
      border-radius: 16px;
      padding: 40px 20px;
      text-align: center;
      color: var(--text-secondary);
      transition: all 0.3s ease;
    }
    
    .empty-state-icon {
      font-size: 48px;
      margin-bottom: 12px;
      opacity: 0.5;
    }
    
    /* Navigation */
    .nav-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding: 0 5px;
      position: relative;
      z-index: 1001;
    }

    .nav-title {
      font-size: 20px;
      font-weight: 800;
      color: var(--nav-text);
      text-shadow: 0 2px 4px rgba(0,0,0,0.1);
      cursor: pointer;
      transition: all 0.2s;
      text-decoration: none;
      display: block;
    }

    .nav-title:hover {
      transform: scale(1.05);
      text-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    .nav-toggle {
      background: var(--badge-bg);
      border: 1px solid var(--badge-border);
      color: var(--nav-text);
      font-size: 24px;
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
      z-index: 1002;
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .nav-toggle:hover {
      background: var(--badge-hover);
    }

    .nav-toggle .hamburger {
      display: block;
    }

    .nav-toggle .close {
      display: none;
      font-size: 28px;
    }

    .nav-toggle.active .hamburger {
      display: none;
    }

    .nav-toggle.active .close {
      display: block;
    }

    /* Navigation Overlay Backdrop */
    .nav-backdrop {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(4px);
      z-index: 999;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .nav-backdrop.active {
      display: block;
      opacity: 1;
    }

    /* Navigation Links Overlay */
    .nav-links {
      position: fixed;
      top: 0;
      right: -300px;
      width: 280px;
      height: 100vh;
      background: linear-gradient(180deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
      border-left: 1px solid var(--badge-border);
      padding: 80px 20px 20px;
      box-shadow: -4px 0 20px rgba(0, 0, 0, 0.3);
      z-index: 1000;
      overflow-y: auto;
      transition: right 0.3s ease;
    }
    
    .nav-links.active {
      right: 0;
    }
    
    .nav-links a {
      display: block;
      color: var(--nav-text);
      text-decoration: none;
      padding: 14px 18px;
      margin: 8px 0;
      border-radius: 10px;
      background: var(--badge-bg);
      backdrop-filter: blur(10px);
      font-weight: 600;
      font-size: 15px;
      transition: all 0.2s;
      white-space: nowrap;
      border: 1px solid var(--badge-border);
    }
    
    .nav-links a:hover {
      background: var(--badge-hover);
      transform: translateX(-4px);
      border-color: var(--badge-border);
    }
    
    .nav-links a.active {
      background: var(--badge-hover);
      border-color: var(--badge-border);
      box-shadow: 0 0 0 2px var(--badge-border);
    }

    /* Responsive adjustments */
    @media (max-width: 480px) {
      .nav-links {
        width: 100%;
        right: -100%;
      }
    }

    .live-badge {
      display: flex;
      align-items: center;
      justify-content: center;
      background: #ef4444;
      color: white;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 10px;
      font-weight: 700;
      letter-spacing: 0.5px;
      margin: 0 12px;
    }
    
    /* Dark Mode Toggle */
    .theme-toggle {
      background: var(--badge-bg);
      border: 1px solid var(--badge-border);
      color: var(--nav-text);
      font-size: 20px;
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 8px;
    }
    
    .theme-toggle:hover {
      background: var(--badge-hover);
      transform: scale(1.05);
    }
    
    .theme-toggle:active {
      transform: scale(0.95);
    }
  </style>
  <script>
    // Dark Mode Management (Global - works across all pages)
    function initTheme() {
      const savedTheme = localStorage.getItem('cricketbook_theme') || 'light';
      document.documentElement.setAttribute('data-theme', savedTheme);
      updateThemeIcon(savedTheme);
    }
    
    function toggleTheme() {
      const currentTheme = document.documentElement.getAttribute('data-theme');
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      
      document.documentElement.setAttribute('data-theme', newTheme);
      localStorage.setItem('cricketbook_theme', newTheme);
      updateThemeIcon(newTheme);
      
      // Log for debugging
      console.log('🌓 Theme switched to:', newTheme);
    }
    
    function updateThemeIcon(theme) {
      const themeToggle = document.getElementById('themeToggle');
      if (themeToggle) {
        themeToggle.textContent = theme === 'dark' ? '🌞' : '🌜';
        themeToggle.title = theme === 'dark' ? 'Switch to Light Mode' : 'Switch to Dark Mode';
      }
    }
    
    // Initialize theme on page load
    initTheme();
    
    function toggleNav() {
      const navLinks = document.getElementById('navLinks');
      const navBackdrop = document.getElementById('navBackdrop');
      const navToggle = document.querySelector('.nav-toggle');
      
      navLinks.classList.toggle('active');
      navBackdrop.classList.toggle('active');
      navToggle.classList.toggle('active');
      
      // Prevent body scroll when nav is open
      if (navLinks.classList.contains('active')) {
        document.body.style.overflow = 'hidden';
      } else {
        document.body.style.overflow = '';
      }
    }
  </script>
</head>
<body>
  <div class="container">
    <!-- Navigation -->
    <div class="nav-backdrop" id="navBackdrop" onclick="toggleNav()"></div>
    <div class="nav-header">
      <a href="index.html" class="nav-title">🏏 CricketBook</a>
      <div style="display: flex; align-items: center;">
        <button class="theme-toggle" id="themeToggle" onclick="toggleTheme()" title="Toggle Dark Mode">
          🌜
        </button>
        <button class="nav-toggle" onclick="toggleNav()">
          <span class="hamburger">☰</span>
          <span class="close">×</span>
        </button>
      </div>
    </div>
    <nav class="nav-links" id="navLinks">
      <a href="index.html">🏠 Home</a>
      <a href="livescore.html" class="active">📺 Live Score</a>
      <a href="matches.html">📋 My Matches</a>
      <a href="allmatches.html">🌍 All Matches</a>
      <a href="about.html">ℹ️ About</a>
    </nav>
    
    <div class="loading" id="loading">Loading match data...</div>
    
    <div id="content" style="display:none">
      <div class="card">
        <!-- Match Completed Banner -->
        <div id="matchCompletedBanner" style="display:none;text-align:center;margin-bottom:12px;padding:10px 16px;background:linear-gradient(135deg, #10b981 0%, #059669 50%, #047857 100%);border-radius:12px;color:#ffffff;font-size:15px;font-weight:700;letter-spacing:0.5px;box-shadow:0 4px 12px rgba(16,185,129,0.4);">
          🏏 Match Completed
        </div>
        
        <!-- Tournament Header -->
        <div id="tournamentHeader" style="display:none;text-align:center;margin-bottom:16px;padding:10px 16px;background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);border-radius:12px;color:#ffffff;font-size:14px;font-weight:700;letter-spacing:1px;box-shadow:0 2px 8px rgba(102,126,234,0.3);">
          <span id="tournamentTitle"></span>
        </div>
        
        <!-- Share Button -->
        <div style="text-align:center;margin-bottom:16px;">
          <button onclick="shareOnWhatsApp()" style="background:linear-gradient(135deg, #25D366 0%, #128C7E 100%);color:white;border:none;padding:8px 16px;border-radius:10px;font-size:13px;font-weight:600;cursor:pointer;box-shadow:0 3px 8px rgba(37,211,102,0.25);transition:all 0.2s;display:inline-flex;align-items:center;gap:6px;">
            <span style="font-size:16px;">📱</span>
            Share on WhatsApp
          </button>
        </div>
        
        <!-- 📊 Scoreboard Header -->
        <div class="scoreboard">
          <!-- Team Name & Score Display (Two Column Layout) -->
          <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:16px;padding-bottom:12px;border-bottom:2px solid #e5e7eb;gap:12px;">
            <!-- Team A -->
            <div style="flex:1;text-align:left;">
              <div style="font-size:18px;font-weight:800;background:linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:4px;" id="teamAName">Team A</div>
              <div style="font-size:48px;font-weight:900;color:#3b82f6;line-height:1;margin-bottom:4px;" id="scoreA">0/0</div>
              <div style="font-size:13px;color:#6b7280;font-weight:800;" id="teamAOvers">(0.0 overs)</div>
            </div>
            
            <!-- LIVE NOW Badge -->
            <div id="liveBadge" class="live-badge" style="display:none;">
            LIVE
            </div>
            
            <!-- Team B -->
            <div style="flex:1;text-align:right;">
              <div style="font-size:18px;font-weight:800;background:linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:4px;" id="teamBName">Team B</div>
              <div style="font-size:48px;font-weight:900;color:#8b5cf6;line-height:1;margin-bottom:4px;" id="scoreB">0/0</div>
              <div style="font-size:13px;color:#6b7280;font-weight:800;" id="teamBOvers">(0.0 overs)</div>
            </div>
          </div>

          <!-- Result Display -->
          <div id="result" class="result-banner"></div>

          <!-- Overs Info -->
          <div id="oversExtrasInfo" style="text-align:center;margin-bottom:12px;padding:12px 18px;background:linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);border:2px solid #60a5fa;border-radius:12px;font-size:14px;font-weight:800;color:#1e40af;letter-spacing:0.5px;box-shadow:0 4px 12px rgba(96,165,250,0.25);"></div>

          <!-- Live Over Display -->
          <div id="liveOverDisplay" style="margin-bottom:12px;padding:8px 10px;background:linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);border:2px solid #e2e8f0;border-radius:12px;box-shadow:0 2px 6px rgba(0,0,0,0.04);"></div>

          <!-- First Innings Info Banner -->
          <div id="firstInningsInfo" style="display:none;text-align:center;margin-bottom:12px;padding:12px 16px;border-radius:12px;background:linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);color:#ffffff;font-size:14px;font-weight:700;box-shadow:0 4px 12px rgba(59,130,246,0.3);letter-spacing:0.3px;"></div>
        </div>

        <!-- Win Probability (Compact Design) -->
        <div id="winProbabilityCompact" style="margin-top:20px;margin-bottom:12px;padding:0 16px 12px 16px;background:var(--card-bg);border-radius:10px;box-shadow:0 2px 6px rgba(0,0,0,0.08);">
          <!-- Header -->
          <div style="font-size:9px;color:var(--text-secondary);font-weight:700;text-align:center;padding-top:12px;margin-bottom:8px;letter-spacing:0.5px;">
            📊 WIN PROBABILITY
          </div>
          
          <!-- Visual Progress Bar -->
          <div style="height:10px;background:linear-gradient(90deg, #e2e8f0 0%, #e2e8f0 100%);border-radius:20px;overflow:hidden;position:relative;box-shadow:inset 0 2px 4px rgba(0,0,0,0.1);margin-bottom:8px;">
            <div id="winProbBar" style="height:100%;background:linear-gradient(90deg, #3b82f6 0%, #8b5cf6 100%);width:50%;transition:width 0.5s ease;border-radius:20px;box-shadow:0 0 8px rgba(59,130,246,0.5);"></div>
          </div>
          
          <!-- Team Percentages Row -->
          <div style="display:flex;justify-content:space-between;align-items:center;">
            <!-- Team 1 -->
            <div style="flex:1;text-align:left;">
              <span style="font-size:10px;color:var(--text-secondary);font-weight:600;" id="winTeam1Name">Team A</span>
              <span style="font-size:14px;font-weight:900;margin-left:4px;background:linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;" id="winTeam1Prob">50%</span>
            </div>
            
            <!-- Match Phase -->
            <div style="font-size:8px;color:var(--text-tertiary);font-weight:600;text-align:center;flex:0 0 auto;padding:0 8px;" id="matchPhase">—</div>
            
            <!-- Team 2 -->
            <div style="flex:1;text-align:right;">
              <span style="font-size:14px;font-weight:900;margin-right:4px;background:linear-gradient(135deg, #8b5cf6 0%, #3b82f6 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;" id="winTeam2Prob">50%</span>
              <span style="font-size:10px;color:var(--text-secondary);font-weight:600;" id="winTeam2Name">Team B</span>
            </div>
          </div>
        </div>

        <!-- Live Stats Comparison -->
        <div id="liveStatsComparison" style="margin-top:20px;display:none;">
          <!-- Row 1: Sixes, Fours, Threes, Twos -->
          <div style="background:var(--card-bg);border-radius:10px;padding:10px 12px;box-shadow:0 2px 6px rgba(0,0,0,0.08);margin-bottom:8px;display:flex;justify-content:space-around;align-items:center;gap:6px;">
            <!-- Sixes -->
            <div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:2px;">
              <div style="font-size:9px;color:var(--text-secondary);font-weight:600;">🚀 SIXES</div>
              <div style="display:flex;gap:3px;align-items:center;">
                <span style="font-size:15px;font-weight:900;color:#8b5cf6;" id="team1Sixes">0</span>
                <span style="font-size:10px;color:var(--text-secondary);">-</span>
                <span style="font-size:15px;font-weight:900;color:#8b5cf6;" id="team2Sixes">0</span>
              </div>
            </div>
            
            <!-- Fours -->
            <div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:2px;">
              <div style="font-size:9px;color:var(--text-secondary);font-weight:600;">⚡ FOURS</div>
              <div style="display:flex;gap:3px;align-items:center;">
                <span style="font-size:15px;font-weight:900;color:#3b82f6;" id="team1Fours">0</span>
                <span style="font-size:10px;color:var(--text-secondary);">-</span>
                <span style="font-size:15px;font-weight:900;color:#3b82f6;" id="team2Fours">0</span>
              </div>
            </div>
            
            <!-- Threes -->
            <div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:2px;">
              <div style="font-size:9px;color:var(--text-secondary);font-weight:600;">3️⃣ 3s</div>
              <div style="display:flex;gap:3px;align-items:center;">
                <span style="font-size:15px;font-weight:900;color:#06b6d4;" id="team1Threes">0</span>
                <span style="font-size:10px;color:var(--text-secondary);">-</span>
                <span style="font-size:15px;font-weight:900;color:#06b6d4;" id="team2Threes">0</span>
              </div>
            </div>
            
            <!-- Twos -->
            <div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:2px;">
              <div style="font-size:9px;color:var(--text-secondary);font-weight:600;">2️⃣ 2s</div>
              <div style="display:flex;gap:3px;align-items:center;">
                <span style="font-size:15px;font-weight:900;color:#14b8a6;" id="team1Twos">0</span>
                <span style="font-size:10px;color:var(--text-secondary);">-</span>
                <span style="font-size:15px;font-weight:900;color:#14b8a6;" id="team2Twos">0</span>
              </div>
            </div>
          </div>
          
          <!-- Row 2: Singles, Wickets, Dots, Extras -->
          <div style="background:var(--card-bg);border-radius:10px;padding:10px 12px;box-shadow:0 2px 6px rgba(0,0,0,0.08);margin-bottom:12px;display:flex;justify-content:space-around;align-items:center;gap:6px;">
            <!-- Singles -->
            <div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:2px;">
              <div style="font-size:9px;color:var(--text-secondary);font-weight:600;">1️⃣ 1s</div>
              <div style="display:flex;gap:3px;align-items:center;">
                <span style="font-size:15px;font-weight:900;color:#84cc16;" id="team1Singles">0</span>
                <span style="font-size:10px;color:var(--text-secondary);">-</span>
                <span style="font-size:15px;font-weight:900;color:#84cc16;" id="team2Singles">0</span>
              </div>
            </div>
            
            <!-- Wickets -->
            <div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:2px;">
              <div style="font-size:9px;color:var(--text-secondary);font-weight:600;">🎯 Ws</div>
              <div style="display:flex;gap:3px;align-items:center;">
                <span style="font-size:15px;font-weight:900;color:#dc2626;" id="team1Wickets">0</span>
                <span style="font-size:10px;color:var(--text-secondary);">-</span>
                <span style="font-size:15px;font-weight:900;color:#dc2626;" id="team2Wickets">0</span>
              </div>
            </div>
            
            <!-- Dot Balls -->
            <div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:2px;">
              <div style="font-size:9px;color:var(--text-secondary);font-weight:600;">⏸️ DOTS</div>
              <div style="display:flex;gap:3px;align-items:center;">
                <span style="font-size:15px;font-weight:900;color:#f59e0b;" id="team1Dots">0</span>
                <span style="font-size:10px;color:var(--text-secondary);">-</span>
                <span style="font-size:15px;font-weight:900;color:#f59e0b;" id="team2Dots">0</span>
              </div>
            </div>
            
            <!-- Extras -->
            <div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:2px;">
              <div style="font-size:9px;color:var(--text-secondary);font-weight:600;">➕ EXTRAS</div>
              <div style="display:flex;gap:3px;align-items:center;">
                <span style="font-size:15px;font-weight:900;color:#10b981;" id="team1ExtrasDisplay">0</span>
                <span style="font-size:10px;color:var(--text-secondary);">-</span>
                <span style="font-size:15px;font-weight:900;color:#10b981;" id="team2ExtrasDisplay">0</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Match Summary (shown from start, updates in real-time) -->
        <div id="matchSummary" style="margin-top:20px;">
          <div style="font-size:16px;font-weight:700;color:var(--text-primary);margin-bottom:16px;text-align:center;">
            📊 MATCH SUMMARY
          </div>
          
          <!-- 3-Column Table for Match Summary -->
          <div>
            <table id="matchSummaryTable" style="width:100%;border-collapse:collapse;background:#f8fafc;border-radius:12px;overflow:hidden;box-shadow:0 2px 8px rgba(0,0,0,0.05);table-layout:fixed;">
              <thead>
                <tr style="background:linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);color:#fff;">
                  <th rowspan="2" style="padding:6px 2px;font-size:11px;font-weight:700;text-align:center;border-right:1px solid rgba(255,255,255,0.2);width:32px;vertical-align:middle;">Ovs</th>
                  <th id="team1Header" style="padding:6px 6px 2px 6px;font-size:13px;font-weight:700;text-align:center;border-right:1px solid rgba(255,255,255,0.2);width:50%;">Team 1</th>
                  <th id="team2Header" style="padding:6px 6px 2px 6px;font-size:13px;font-weight:700;text-align:center;width:50%;">Team 2</th>
                </tr>
                <tr style="background:linear-gradient(135deg, #2563eb 0%, #7c3aed 100%);color:#fff;">
                  <th id="team1Stats" style="padding:4px 8px 8px 8px;font-size:11px;font-weight:600;text-align:center;border-right:1px solid rgba(255,255,255,0.2);opacity:0.95;letter-spacing:0.3px;line-height:1.6;">—</th>
                  <th id="team2Stats" style="padding:4px 8px 8px 8px;font-size:11px;font-weight:600;text-align:center;opacity:0.95;letter-spacing:0.3px;line-height:1.6;">—</th>
                </tr>
              </thead>
              <tbody id="matchSummaryBody">
                <tr>
                  <td colspan="3" style="text-align:center;color:#94a3b8;padding:20px;font-size:13px;">No overs bowled yet</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/11.1.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.1.0/firebase-database-compat.js"></script>

  <script>
    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyAFfwgHq761oFMg4CVqmZezGR_WK6ZGvAY",
      authDomain: "cricketbook-35725.firebaseapp.com",
      databaseURL: "https://cricketbook-35725-default-rtdb.firebaseio.com",
      projectId: "cricketbook-35725",
      storageBucket: "cricketbook-35725.firebasestorage.app",
      messagingSenderId: "128747950424",
      appId: "1:128747950424:web:dce02e8420c353f1acd52d"
    };

    // Initialize Firebase (check if firebase is loaded)
    let database;
    if (typeof firebase !== 'undefined') {
      firebase.initializeApp(firebaseConfig);
      database = firebase.database();
    } else {
      console.error('❌ Firebase SDK not loaded');
    }

    // Track active listeners for cleanup
    let currentMatchRef = null;
    let matchesListenerRef = null;
    let pollingInterval = null; // For polling instead of continuous listeners
    let lastActivityTime = Date.now(); // Track last user activity
    let isPollingPaused = false; // Track if polling is paused

    // Organization ID for multi-user isolation
    let organizationId = localStorage.getItem('cricketbook_org_id');
    
    // Check if orgId is provided in URL (from share link)
    const urlParams = new URLSearchParams(window.location.search);
    const urlOrgId = urlParams.get('org');
    
    if (urlOrgId) {
      // Share link with org ID - save it to localStorage for navigation to other pages
      organizationId = urlOrgId;
      localStorage.setItem('cricketbook_org_id', organizationId);
      console.log('🔗 Using Organization ID from share link and saved to localStorage:', organizationId);
    } else if (!organizationId) {
      // No org ID in URL or localStorage - show helpful message
      console.warn('⚠️ No Organization ID found. Please start a match first.');
      document.getElementById('loading').innerHTML = '<div class="empty-state"><div class="empty-state-icon">🏏</div><div style="font-size:18px;font-weight:700;margin-bottom:8px;color:#1f2937;">Ready to Watch Live Cricket?</div><div style="color:#6b7280;font-size:14px;line-height:1.6;margin-bottom:20px;">Start scoring a new match or ask your scorer to share the live score link with you!</div><a href="index.html" class="btn" style="background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);color:white;padding:12px 28px;border-radius:12px;text-decoration:none;display:inline-block;font-weight:700;box-shadow:0 4px 12px rgba(102,126,234,0.3);transition:all 0.2s;">🏠 Go to Home</a></div>';
    } else {
      console.log('✅ Using Organization ID from localStorage:', organizationId);
    }

    // Get match ID from URL or localStorage
    let matchId = urlParams.get('match');
    if (matchId) {
      localStorage.setItem('lastMatchId', matchId);
      if (organizationId) {
        loadMatch(matchId);
      }
    } else {
      // Always try to find live match first
      if (organizationId) {
        findAndLoadLiveMatch();
      }
    }

    function findAndLoadLiveMatch() {
      console.log('🔍 Auto-detecting live match for org:', organizationId);
      document.getElementById('loading').innerHTML = '<div class="loading">🔍 Finding live match...</div>';
      
      // Clean up previous matches listener if exists
      if (matchesListenerRef) {
        matchesListenerRef.off();
      }
      
      // Check both tournament and quick match paths
      Promise.all([
        database.ref('tournaments/' + organizationId + '/matches').once('value'),
        database.ref('quickMatches/' + organizationId + '/matches').once('value')
      ]).then(([tournamentSnapshot, quickMatchSnapshot]) => {
        const tournamentMatches = tournamentSnapshot.val() || {};
        const quickMatches = quickMatchSnapshot.val() || {};
        const allMatches = { ...tournamentMatches, ...quickMatches };
        
        console.log('🏏 Tournament matches found:', Object.keys(tournamentMatches).length);
        console.log('⚡ Quick matches found:', Object.keys(quickMatches).length);
        
        if (Object.keys(allMatches).length === 0) {
          document.getElementById('loading').innerHTML = '<div class="empty-state"><div class="empty-state-icon">🏏</div><div style="font-size:18px;font-weight:700;margin-bottom:8px;color:#1f2937;">No Matches Yet</div><div style="color:#6b7280;font-size:14px;line-height:1.6;margin-bottom:20px;">Looks like there are no live matches at the moment.<br>Start scoring your first match and it will appear here!</div><a href="index.html" style="background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);color:white;padding:12px 28px;border-radius:12px;text-decoration:none;display:inline-block;font-weight:700;box-shadow:0 4px 12px rgba(102,126,234,0.3);transition:all 0.2s;">🏠 Go to Home & Start Scoring</a></div>';
          // Retry after 5 seconds
          setTimeout(findAndLoadLiveMatch, 5000);
          return;
        }
        
        // Convert to array and sort by lastUpdated (newest first)
        const matchesArray = Object.keys(allMatches).map(id => ({
          matchId: id,
          ...allMatches[id]
        })).sort((a, b) => (b.lastUpdated || 0) - (a.lastUpdated || 0));
        
        console.log('📋 All matches for this org:', matchesArray);
        
        // Find first live match (not completed)
        const liveMatch = matchesArray.find(match => {
          if (match.matchCompleted) return false;
          if (match.resultText && match.resultText.trim() !== '') return false;
          
          const firstDone = match.first?.done || false;
          const secondDone = match.second?.done || false;
          const inSecond = match.inSecond || false;
          
          return (!inSecond && !firstDone) || (inSecond && !secondDone);
        });
        
        if (liveMatch) {
          console.log('⚡ Found live match:', liveMatch.matchId);
          // Only load if it's a different match than currently loaded
          if (matchId !== liveMatch.matchId) {
            matchId = liveMatch.matchId;
            localStorage.setItem('lastMatchId', matchId);
            // Load new match with polling
            loadMatch(matchId);
          }
        } else {
          // No live match, show most recent match
          if (matchesArray.length > 0) {
            console.log('📊 No live match, showing most recent');
            if (matchId !== matchesArray[0].matchId) {
              matchId = matchesArray[0].matchId;
              localStorage.setItem('lastMatchId', matchId);
              loadMatch(matchId);
            }
          } else {
            document.getElementById('loading').innerHTML = '<div class="error">No matches available.</div>';
          }
        }
      }).catch((error) => {
        console.error('❌ Error finding match:', error);
        
        // Check if it's a connection limit error
        if (error.code === 'PERMISSION_DENIED' || error.message.includes('connection') || error.message.includes('limit')) {
          document.getElementById('loading').innerHTML = `
            <div class="error" style="padding:32px;">
              <div style="font-size:48px;margin-bottom:16px;">⚠️</div>
              <h2 style="color:#ef4444;font-size:22px;margin-bottom:12px;">Connection Limit Reached</h2>
              <p style="margin-bottom:20px;">Too many viewers right now! The match is very popular. 🏏</p>
              <p style="margin-bottom:24px;font-size:14px;">Please wait a few minutes and try again.</p>
              <button onclick="location.reload()" style="background:#3b82f6;color:white;border:none;padding:12px 28px;border-radius:10px;font-size:15px;font-weight:700;cursor:pointer;">
                🔄 Try Again
              </button>
            </div>
          `;
        } else {
          document.getElementById('loading').innerHTML = '<div class="error">Error finding match: ' + error.message + '</div>';
        }
      });
    }

    function loadMatch(id) {
      console.log('🔗 Loading match:', id, 'from org:', organizationId);
      if (!id) {
        console.error('❌ No match ID provided');
        document.getElementById('loading').innerHTML = '<div class="error">No match ID provided.</div>';
        return;
      }
      
      // Clean up previous match listener if exists
      if (currentMatchRef) {
        currentMatchRef.off();
      }
      
      // Clean up previous polling interval
      if (pollingInterval) {
        clearInterval(pollingInterval);
      }
      
      // Use polling instead of continuous listener to reduce active connections
      const pollMatch = () => {
        // Try tournament path first, then quick matches path
        database.ref('tournaments/' + organizationId + '/matches/' + id).once('value', (snapshot) => {
          let data = snapshot.val();
          
          if (data) {
            console.log('📡 Polled update from Firebase (tournament match)', id);
            updateUI(data);
            document.getElementById('loading').style.display = 'none';
            document.getElementById('content').style.display = 'block';
          } else {
            // Try quick matches path
            database.ref('quickMatches/' + organizationId + '/matches/' + id).once('value', (snapshot2) => {
              data = snapshot2.val();
              if (data) {
                console.log('📡 Polled update from Firebase (quick match)', id);
                updateUI(data);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('content').style.display = 'block';
              } else {
                console.warn('⚠️ Match not found:', id);
                document.getElementById('loading').innerHTML = '<div class="error">Match ID "' + id + '" not found in Firebase. <br><br>Try refreshing or start a new match.</div>';
                // Stop polling if match not found
                if (pollingInterval) {
                  clearInterval(pollingInterval);
                }
              }
            });
          }
        }, (error) => {
          console.error('❌ Firebase error:', error);
          
          // Check if it's a connection limit error
          if (error.code === 'PERMISSION_DENIED' || error.message.includes('connection') || error.message.includes('limit')) {
            document.getElementById('loading').innerHTML = `
              <div class="error" style="padding:32px;">
                <div style="font-size:48px;margin-bottom:16px;">⚠️</div>
                <h2 style="color:#ef4444;font-size:22px;margin-bottom:12px;">Connection Limit Reached</h2>
                <p style="margin-bottom:20px;">Too many people are watching this match right now! 🏏</p>
                <p style="margin-bottom:24px;font-size:14px;">Please wait a few minutes and try again.</p>
                <button onclick="location.reload()" style="background:#3b82f6;color:white;border:none;padding:12px 28px;border-radius:10px;font-size:15px;font-weight:700;cursor:pointer;">
                  🔄 Try Again
                </button>
              </div>
            `;
            
            // Stop polling
            if (pollingInterval) {
              clearInterval(pollingInterval);
            }
          } else {
            document.getElementById('loading').innerHTML = '<div class="error">Error loading match: ' + error.message + '</div>';
          }
        });
      };
      
      // Initial load
      pollMatch();
      
      // Poll every 2 seconds for updates (instead of continuous listener)
      pollingInterval = setInterval(pollMatch, 2000);
      
      console.log('✅ Polling enabled (every 2 seconds) - reduced active connections');
      
      // Periodically check for new live matches (every 30 seconds)
      const liveMatchScanInterval = setInterval(() => {
        console.log('🔍 Periodic scan for new live matches...');
        findAndLoadLiveMatch();
      }, 30000); // Re-scan every 30 seconds
      
      console.log('🔄 Live match scanner enabled (every 30 seconds)');
      
      // Inactivity checker - pause polling after 15 minutes of inactivity
      setInterval(() => {
        const inactiveTime = Date.now() - lastActivityTime;
        const fifteenMinutes = 15 * 60 * 1000;
        
        if (inactiveTime > fifteenMinutes && !isPollingPaused) {
          console.log('⏸️ Pausing polling due to 15 min inactivity');
          if (pollingInterval) {
            clearInterval(pollingInterval);
            pollingInterval = null;
            isPollingPaused = true;
          }
        }
      }, 30000); // Check every 30 seconds
      
      // Track user activity
      ['mousedown', 'keydown', 'scroll', 'touchstart', 'click'].forEach(event => {
        document.addEventListener(event, () => {
          lastActivityTime = Date.now();
          
          // Resume polling if paused
          if (isPollingPaused) {
            console.log('▶️ Resuming polling - user activity detected');
            isPollingPaused = false;
            pollMatch(); // Immediate refresh
            pollingInterval = setInterval(pollMatch, 2000);
          }
        }, { passive: true });
      });
      
      // Pause when page hidden
      document.addEventListener('visibilitychange', () => {
        if (document.hidden) {
          console.log('👁️ Page hidden - pausing polling');
          if (pollingInterval) {
            clearInterval(pollingInterval);
            pollingInterval = null;
          }
        } else {
          console.log('👁️ Page visible - resuming polling');
          lastActivityTime = Date.now();
          isPollingPaused = false;
          pollMatch(); // Immediate refresh
          pollingInterval = setInterval(pollMatch, 2000);
        }
      });
    }

    // Update UI with match data
    function updateUI(data) {
      console.log('🎨 Updating UI with data:', data);
      const inn = data.inSecond ? data.second : data.first;
      const isBattingFirst = !data.inSecond;
      
      // Update page title with team names
      if (data.teamA && data.teamB) {
        document.getElementById('pageTitle').textContent = `${data.teamA} vs ${data.teamB} - Live Score`;
        // Update meta description
        const metaDesc = document.querySelector('meta[name="description"]');
        if (metaDesc) {
          metaDesc.content = `Live cricket score: ${data.teamA} vs ${data.teamB}`;
        }
      }
      
      // Team A & B Header Display
      document.getElementById('teamAName').textContent = data.teamA || 'Team A';
      document.getElementById('teamBName').textContent = data.teamB || 'Team B';
      
      // Determine if match is completed - compute once
      const isMatchCompleted = data.matchCompleted === true || 
                               (data.first && data.first.done && data.second && data.second.done) ||
                               (data.inSecond && data.second && data.second.done);
      
      // Update tournament header if tournament name exists
      const tournamentHeader = document.getElementById('tournamentHeader');
      const tournamentTitle = document.getElementById('tournamentTitle');
      if (data.tournamentName && data.tournamentName.trim() !== '') {
        const matchTypeText = data.matchType ? ` - ${data.matchType}` : '';
        tournamentTitle.textContent = `#${data.tournamentName}${matchTypeText}`;
        tournamentHeader.style.display = 'block';
      } else {
        tournamentHeader.style.display = 'none';
      }
      
      // Show/Hide LIVE badge and completion banner based on match status
      const liveBadge = document.getElementById('liveBadge');
      const matchCompletedBanner = document.getElementById('matchCompletedBanner');
      
      if (isMatchCompleted) {
        // Match completed
        liveBadge.style.display = 'none';
        matchCompletedBanner.style.display = 'block';
      } else {
        // Match is live - check if stalled (no update in 15+ minutes)
        const currentTime = Date.now();
        const lastUpdate = data.lastUpdated || data.timestamp || 0;
        const minutesSinceUpdate = (currentTime - lastUpdate) / (1000 * 60);
        const isStalled = minutesSinceUpdate >= 15;
        
        if (isStalled) {
          liveBadge.textContent = '⚠️ STALLED';
          liveBadge.style.background = 'linear-gradient(135deg, #f59e0b 0%, #ef4444 100%)';
        } else {
          liveBadge.textContent = 'LIVE';
          liveBadge.style.background = 'linear-gradient(135deg, #10b981 0%, #3b82f6 100%)';
        }
        
        liveBadge.style.display = 'flex';
        matchCompletedBanner.style.display = 'none';
      }
      
      const firstScore = `${data.first?.runs || 0}/${data.first?.wkts || 0}`;
      const firstOvers = calculateOvers(data.first?.legalBalls || 0);
      const oversLimit = data.oversLimit || 20;
      document.getElementById('scoreA').textContent = firstScore;
      document.getElementById('teamAOvers').textContent = `(${firstOvers}/${oversLimit} overs)`;
      
      const secondScore = `${data.second?.runs || 0}/${data.second?.wkts || 0}`;
      const secondOvers = calculateOvers(data.second?.legalBalls || 0);
      document.getElementById('scoreB').textContent = secondScore;
      document.getElementById('teamBOvers').textContent = `(${secondOvers}/${oversLimit} overs)`;
      
      // Highlight currently batting team with larger score and gradient text
      const teamAScore = document.getElementById('scoreA');
      const teamBScore = document.getElementById('scoreB');
      const teamAName = document.getElementById('teamAName');
      const teamBName = document.getElementById('teamBName');
      
      if (isBattingFirst) {
        // Team A batting
        teamAScore.style.fontSize = '48px';
        teamBScore.style.fontSize = '28px';
        teamAScore.style.color = '#3b82f6';
        teamBScore.style.color = '#cbd5e1';
        teamAName.style.background = 'linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%)';
        teamAName.style.webkitBackgroundClip = 'text';
        teamAName.style.webkitTextFillColor = 'transparent';
        teamAName.style.backgroundClip = 'text';
        teamBName.style.background = 'none';
        teamBName.style.webkitBackgroundClip = 'unset';
        teamBName.style.webkitTextFillColor = 'unset';
        teamBName.style.backgroundClip = 'unset';
        teamBName.style.color = '#94a3b8';
      } else {
        // Team B batting
        teamAScore.style.fontSize = '28px';
        teamBScore.style.fontSize = '48px';
        teamAScore.style.color = '#cbd5e1';
        teamBScore.style.color = '#8b5cf6';
        teamAName.style.background = 'none';
        teamAName.style.webkitBackgroundClip = 'unset';
        teamAName.style.webkitTextFillColor = 'unset';
        teamAName.style.backgroundClip = 'unset';
        teamAName.style.color = '#94a3b8';
        teamBName.style.background = 'linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%)';
        teamBName.style.webkitBackgroundClip = 'text';
        teamBName.style.webkitTextFillColor = 'transparent';
        teamBName.style.backgroundClip = 'text';
      }
      
      // Result - only show if match is actually completed
      if (data.resultText && data.resultText.trim() !== '' && isMatchCompleted) {
        document.getElementById('result').textContent = data.resultText;
        document.getElementById('result').classList.add('show');
        // Hide live match elements when result is displayed
        document.getElementById('oversExtrasInfo').style.display = 'none';
        document.getElementById('liveOverDisplay').style.display = 'none';
        document.getElementById('firstInningsInfo').style.display = 'none';
      } else {
        document.getElementById('result').classList.remove('show');
        // Show live match elements during active match
        document.getElementById('oversExtrasInfo').style.display = 'block';
        document.getElementById('liveOverDisplay').style.display = 'block';
        
        // Overs & Extras Info
        const overs = calculateOvers(inn.legalBalls || 0);
        const extras = calculateExtras(inn);
        const rr = inn.legalBalls > 0 ? ((inn.runs || 0) * 6 / inn.legalBalls).toFixed(2) : '0.00';
        document.getElementById('oversExtrasInfo').innerHTML = `Overs: <strong>${overs}</strong> | CRR: <strong>${rr}</strong> | Extras: <strong>${extras}</strong>`;
        
        // Live Over Display
        updateLiveOver(inn);
        
        // First Innings Info (when in 2nd innings)
        if (data.inSecond && data.first && data.target && data.oversLimit) {
          const need = data.target - (inn.runs || 0);
          const ballsLeft = (data.oversLimit * 6) - (inn.legalBalls || 0);
          const reqRR = need > 0 && ballsLeft > 0 ? (need * 6 / ballsLeft).toFixed(2) : '0.00';
          document.getElementById('firstInningsInfo').textContent = `Need ${need} runs in ${ballsLeft} balls | RRR: ${reqRR}`;
          document.getElementById('firstInningsInfo').style.display = 'block';
        } else {
          document.getElementById('firstInningsInfo').style.display = 'none';
        }
      }
      
      // Update Match Summary in real-time
      showMatchSummary(data);
      
      // Update Live Stats Comparison
      updateLiveStats(data);
    }

    // Calculate overs from legal balls
    function calculateOvers(legalBalls) {
      if (!legalBalls || legalBalls === 0) return '0.0';
      const overs = Math.floor(legalBalls / 6);
      const balls = legalBalls % 6;
      return `${overs}.${balls}`;
    }

    // Calculate extras from innings data
    function calculateExtras(inn) {
      let extras = 0;
      
      // Check completed overs
      if (inn.overs && inn.overs.length > 0) {
        inn.overs.forEach(over => {
          if (over && over.length > 0) {
            over.forEach(ball => {
              if (typeof ball === 'string') {
                if (/^WD/.test(ball)) {
                  const match = ball.match(/^WD\+?(\d+)?/);
                  extras += 1;
                  if (match && match[1]) extras += parseInt(match[1]);
                }
                else if (/^NB/.test(ball)) {
                  const match = ball.match(/^NB\+?(\d+)?/);
                  extras += 1;
                  if (match && match[1]) extras += parseInt(match[1]);
                }
                else if (/^B\+/.test(ball)) {
                  const match = ball.match(/^B\+(\d+)/);
                  if (match && match[1]) extras += parseInt(match[1]);
                }
                else if (/^LB\+/.test(ball)) {
                  const match = ball.match(/^LB\+(\d+)/);
                  if (match && match[1]) extras += parseInt(match[1]);
                }
              }
            });
          }
        });
      }
      
      // Check current over
      if (inn.curOver && inn.curOver.length > 0) {
        inn.curOver.forEach(ball => {
          if (typeof ball === 'string') {
            if (/^WD/.test(ball)) {
              const match = ball.match(/^WD\+?(\d+)?/);
              extras += 1;
              if (match && match[1]) extras += parseInt(match[1]);
            }
            else if (/^NB/.test(ball)) {
              const match = ball.match(/^NB\+?(\d+)?/);
              extras += 1;
              if (match && match[1]) extras += parseInt(match[1]);
            }
            else if (/^B\+/.test(ball)) {
              const match = ball.match(/^B\+(\d+)/);
              if (match && match[1]) extras += parseInt(match[1]);
            }
            else if (/^LB\+/.test(ball)) {
              const match = ball.match(/^LB\+(\d+)/);
              if (match && match[1]) extras += parseInt(match[1]);
            }
          }
        });
      }
      
      return extras;
    }

    // Update live over display
    function updateLiveOver(inn) {
      const container = document.getElementById('liveOverDisplay');
      
      if (!inn) {
        container.innerHTML = '<span style="color:#94a3b8">Waiting for first ball...</span>';
        return;
      }
      
      // Show current over if it exists
      if (inn.curOver && inn.curOver.length > 0) {
        const ballsHtml = inn.curOver.map(sym => {
          const isWicket = /W$/.test(sym) || /\+W$/.test(sym);
          let bgColor = '#3b82f6';
          if (isWicket) bgColor = '#e31d1d';
          else if (sym === 6) bgColor = '#f59e0b';
          else if (sym === 4) bgColor = '#10b981';
          else if (sym === 0) bgColor = '#94a3b8';
          else if (typeof sym === 'string' && (sym.includes('WD') || sym.includes('NB') || sym.includes('B+') || sym.includes('LB+'))) bgColor = '#f59e0b';
          return `<span style="display:inline-block;margin:2px;padding:4px 8px;border-radius:6px;background:${bgColor};color:#fff;font-weight:700;font-size:13px">${sym}</span>`;
        }).join('');
        container.innerHTML = ballsHtml || '<span style="color:#94a3b8">Waiting for first ball...</span>';
      }
      // Show last completed over if no current over
      else if (inn.overs && inn.overs.length > 0) {
        const lastOver = inn.overs[inn.overs.length - 1];
        if (lastOver && lastOver.length > 0) {
          const ballsHtml = lastOver.map(sym => {
            const isWicket = /W$/.test(sym) || /\+W$/.test(sym);
            let bgColor = '#3b82f6';
            if (isWicket) bgColor = '#e31d1d';
            else if (sym === 6) bgColor = '#f59e0b';
            else if (sym === 4) bgColor = '#10b981';
            else if (sym === 0) bgColor = '#94a3b8';
            else if (typeof sym === 'string' && (sym.includes('WD') || sym.includes('NB') || sym.includes('B+') || sym.includes('LB+'))) bgColor = '#f59e0b';
            return `<span style="display:inline-block;margin:2px;padding:4px 8px;border-radius:6px;background:${bgColor};color:#fff;font-weight:700;font-size:13px">${sym}</span>`;
          }).join('');
          container.innerHTML = ballsHtml;
        } else {
          container.innerHTML = '<span style="color:#94a3b8">Waiting for first ball...</span>';
        }
      }
      else {
        container.innerHTML = '<span style="color:#94a3b8">Waiting for first ball...</span>';
      }
    }

    // Calculate batting statistics (sixes, fours, threes, twos, singles, dots) from innings data
    function calculateBattingStats(inn) {
      let sixes = 0;
      let fours = 0;
      let threes = 0;
      let twos = 0;
      let singles = 0;
      let dots = 0;
      
      // Helper function to process ball
      const processBall = (ball) => {
        if (typeof ball === 'string') {
          // Extract numeric value from ball notation
          let runs = 0;
          
          // Check for wicket balls (can have runs)
          if (ball.includes('W+')) {
            const match = ball.match(/W\+(\d+)/);
            if (match) runs = parseInt(match[1]);
          }
          // Check for wide with runs
          else if (ball.includes('WD+')) {
            const match = ball.match(/WD\+(\d+)/);
            if (match) runs = parseInt(match[1]);
          }
          // Check for no ball with runs
          else if (ball.includes('NB+')) {
            const match = ball.match(/NB\+(\d+)/);
            if (match) runs = parseInt(match[1]);
          }
          // Check for byes/leg byes (don't count as batting stats)
          else if (ball.includes('B+') || ball.includes('LB+')) {
            return; // Skip byes and leg byes
          }
          // Regular ball or just wicket
          else if (ball === 'W' || ball === 'WD' || ball === 'NB') {
            return; // No runs off the bat
          }
          // Numeric value
          else {
            runs = parseInt(ball) || 0;
          }
          
          // Count stats
          if (runs === 6) sixes++;
          else if (runs === 4) fours++;
          else if (runs === 3) threes++;
          else if (runs === 2) twos++;
          else if (runs === 1) singles++;
          else if (runs === 0 && ball !== 'WD' && ball !== 'NB' && !ball.includes('WD') && !ball.includes('NB') && !ball.includes('B+') && !ball.includes('LB+')) {
            dots++;
          }
        } else if (typeof ball === 'number') {
          if (ball === 6) sixes++;
          else if (ball === 4) fours++;
          else if (ball === 3) threes++;
          else if (ball === 2) twos++;
          else if (ball === 1) singles++;
          else if (ball === 0) dots++;
        }
      };
      
      // Process completed overs
      if (inn && inn.overs && inn.overs.length > 0) {
        inn.overs.forEach(over => {
          if (over && over.length > 0) {
            over.forEach(processBall);
          }
        });
      }
      
      // Process current over
      if (inn && inn.curOver && inn.curOver.length > 0) {
        inn.curOver.forEach(processBall);
      }
      
      return { sixes, fours, threes, twos, singles, dots };
    }

    // Update live stats comparison section
    function updateLiveStats(data) {
      if (!data) return;
      
      const liveStatsSection = document.getElementById('liveStatsComparison');
      
      // Show section only if match has started
      const hasStarted = (data.first && data.first.legalBalls > 0) || (data.second && data.second.legalBalls > 0);
      if (!hasStarted) {
        liveStatsSection.style.display = 'none';
        return;
      }
      
      liveStatsSection.style.display = 'block';
      
      // Calculate stats for both teams
      const team1Stats = calculateBattingStats(data.first);
      const team2Stats = calculateBattingStats(data.second);
      
      const team1Extras = calculateExtras(data.first);
      const team2Extras = calculateExtras(data.second);
      
      // Update stat values
      document.getElementById('team1Sixes').textContent = team1Stats.sixes;
      document.getElementById('team2Sixes').textContent = team2Stats.sixes;
      document.getElementById('team1Fours').textContent = team1Stats.fours;
      document.getElementById('team2Fours').textContent = team2Stats.fours;
      document.getElementById('team1Threes').textContent = team1Stats.threes;
      document.getElementById('team2Threes').textContent = team2Stats.threes;
      document.getElementById('team1Twos').textContent = team1Stats.twos;
      document.getElementById('team2Twos').textContent = team2Stats.twos;
      document.getElementById('team1Singles').textContent = team1Stats.singles;
      document.getElementById('team2Singles').textContent = team2Stats.singles;
      document.getElementById('team1Wickets').textContent = data.first?.wkts || 0;
      document.getElementById('team2Wickets').textContent = data.second?.wkts || 0;
      document.getElementById('team1Dots').textContent = team1Stats.dots;
      document.getElementById('team2Dots').textContent = team2Stats.dots;
      document.getElementById('team1ExtrasDisplay').textContent = team1Extras;
      document.getElementById('team2ExtrasDisplay').textContent = team2Extras;
      
      // Update Win Probability
      updateWinProbability(data);
    }

    // Calculate and update Win Probability
    function updateWinProbability(data) {
      if (!data) return;
      
      const teamA = data.teamA || 'Team A';
      const teamB = data.teamB || 'Team B';
      
      // Update team names
      document.getElementById('winTeam1Name').textContent = teamA;
      document.getElementById('winTeam2Name').textContent = teamB;
      
      let team1Prob = 50;
      let team2Prob = 50;
      let phaseText = '—';
      
      // Check if match is completed
      const isMatchCompleted = data.matchCompleted === true || 
                               (data.first && data.first.done && data.second && data.second.done);
      
      if (isMatchCompleted) {
        // Match completed - 100% to winner
        if (data.resultText) {
          if (data.resultText.includes(teamA)) {
            team1Prob = 100;
            team2Prob = 0;
          } else if (data.resultText.includes(teamB)) {
            team1Prob = 0;
            team2Prob = 100;
          }
        }
        phaseText = 'Match Completed';
      } else if (data.inSecond && data.second) {
        // Second innings - chasing scenario
        const target = (data.first?.runs || 0) + 1;
        const currentScore = data.second.runs || 0;
        const wicketsLost = data.second.wkts || 0;
        const ballsRemaining = (data.oversLimit * 6) - (data.second.legalBalls || 0);
        const runsNeeded = target - currentScore;
        
        if (runsNeeded <= 0) {
          // Team 2 has won
          team1Prob = 0;
          team2Prob = 100;
          phaseText = 'Target Achieved';
        } else if (wicketsLost >= 10 || ballsRemaining <= 0) {
          // Team 1 has won (all out or overs completed)
          team1Prob = 100;
          team2Prob = 0;
          phaseText = 'Target Failed';
        } else {
          // Calculate win probability based on chase
          const requiredRunRate = ballsRemaining > 0 ? (runsNeeded * 6) / ballsRemaining : 999;
          const currentRunRate = (data.second.legalBalls || 0) > 0 ? 
                                  (currentScore * 6) / data.second.legalBalls : 0;
          
          // Wickets factor (each wicket reduces probability significantly)
          const wicketsInHand = 10 - wicketsLost;
          const wicketsFactor = wicketsInHand / 10;
          
          // Balls remaining factor
          const ballsFactor = ballsRemaining / (data.oversLimit * 6);
          
          // Required run rate factor (comparing with typical achievable rate of 10)
          const rrFactor = Math.max(0, Math.min(1, 1 - (requiredRunRate - 6) / 10));
          
          // Weighted calculation
          team2Prob = Math.round(
            (wicketsFactor * 40) + 
            (ballsFactor * 30) + 
            (rrFactor * 30)
          );
          
          // Clamp between 1-99 during play
          team2Prob = Math.max(1, Math.min(99, team2Prob));
          team1Prob = 100 - team2Prob;
          
          // Determine phase
          const oversCompleted = Math.floor((data.second.legalBalls || 0) / 6);
          if (oversCompleted < 6) {
            phaseText = '⚡ Powerplay';
          } else if (oversCompleted < data.oversLimit - 4) {
            phaseText = '🏃 Middle Overs';
          } else {
            phaseText = '🔥 Death Overs';
          }
        }
      } else if (data.first) {
        // First innings - predict based on score
        const currentScore = data.first.runs || 0;
        const wicketsLost = data.first.wkts || 0;
        const ballsBowled = data.first.legalBalls || 0;
        const totalBalls = data.oversLimit * 6;
        const ballsRemaining = totalBalls - ballsBowled;
        
        if (data.first.done) {
          // First innings complete - estimate based on par score
          const parScore = data.oversLimit * 7; // Rough par: 7 runs per over
          const scoreDiff = currentScore - parScore;
          
          // Convert score difference to probability
          team1Prob = 50 + Math.round(scoreDiff / 2);
          team1Prob = Math.max(10, Math.min(90, team1Prob));
          team2Prob = 100 - team1Prob;
          phaseText = 'Innings Break';
        } else {
          // Innings in progress - project final score
          const currentRR = ballsBowled > 0 ? (currentScore * 6) / ballsBowled : 0;
          const projectedScore = Math.round(currentScore + (currentRR * ballsRemaining / 6));
          const parScore = data.oversLimit * 7;
          
          team1Prob = 50 + Math.round((projectedScore - parScore) / 3);
          team1Prob = Math.max(20, Math.min(80, team1Prob));
          team2Prob = 100 - team1Prob;
          
          // Determine phase
          const oversCompleted = Math.floor(ballsBowled / 6);
          if (oversCompleted < 6) {
            phaseText = '⚡ Powerplay';
          } else if (oversCompleted < data.oversLimit - 4) {
            phaseText = '🏃 Middle Overs';
          } else {
            phaseText = '🔥 Death Overs';
          }
        }
      }
      
      // Update UI
      document.getElementById('winTeam1Prob').textContent = `${team1Prob}%`;
      document.getElementById('winTeam2Prob').textContent = `${team2Prob}%`;
      document.getElementById('winProbBar').style.width = `${team1Prob}%`;
      document.getElementById('matchPhase').textContent = phaseText;
    }

    // Show match summary with ball-by-ball details
    function showMatchSummary(data) {
      if (!data) return;
      
      const firstInnings = data.first;
      const secondInnings = data.second;
      
      // Calculate team 1 stats
      const team1Runs = firstInnings?.runs || 0;
      const team1Wkts = firstInnings?.wkts || 0;
      const team1Overs = calculateOvers(firstInnings?.legalBalls || 0);
      const team1Extras = calculateExtras(firstInnings);
      const team1RR = firstInnings?.legalBalls > 0 ? ((team1Runs * 6) / firstInnings.legalBalls).toFixed(2) : '0.00';
      
      // Calculate team 2 stats
      const team2Runs = secondInnings?.runs || 0;
      const team2Wkts = secondInnings?.wkts || 0;
      const team2Overs = calculateOvers(secondInnings?.legalBalls || 0);
      const team2Extras = calculateExtras(secondInnings);
      const team2RR = secondInnings?.legalBalls > 0 ? ((team2Runs * 6) / secondInnings.legalBalls).toFixed(2) : '0.00';
      
      // Update team headers with scores
      document.getElementById('team1Header').textContent = `${data.teamA || 'Team 1'} - ${team1Runs}/${team1Wkts}`;
      document.getElementById('team2Header').textContent = `${data.teamB || 'Team 2'} - ${team2Runs}/${team2Wkts}`;
      
      // Update team stats row with better formatting
      document.getElementById('team1Stats').innerHTML = `
        <div style="display:flex;justify-content:center;align-items:center;gap:8px;flex-wrap:wrap;">
          <span style="display:inline-flex;align-items:center;gap:3px;">⏱ <strong>${team1Overs}</strong></span>
          <span style="opacity:0.6;">•</span>
          <span style="display:inline-flex;align-items:center;gap:3px;">📈 <strong>${team1RR}</strong></span>
          <span style="opacity:0.6;">•</span>
          <span style="display:inline-flex;align-items:center;gap:3px;">➕ <strong>${team1Extras}</strong></span>
        </div>
      `;
      document.getElementById('team2Stats').innerHTML = data.inSecond ? `
        <div style="display:flex;justify-content:center;align-items:center;gap:8px;flex-wrap:wrap;">
          <span style="display:inline-flex;align-items:center;gap:3px;">⏱ <strong>${team2Overs}</strong></span>
          <span style="opacity:0.6;">•</span>
          <span style="display:inline-flex;align-items:center;gap:3px;">📈 <strong>${team2RR}</strong></span>
          <span style="opacity:0.6;">•</span>
          <span style="display:inline-flex;align-items:center;gap:3px;">➕ <strong>${team2Extras}</strong></span>
        </div>
      ` : '—';
      
      // Get all overs for both innings
      const firstOvers = [...(firstInnings?.overs || [])];
      const secondOvers = [...(secondInnings?.overs || [])];
      
      // Add current over if innings is done or has incomplete over
      const firstInningsDone = firstInnings?.done || data.inSecond;
      if (firstInningsDone && firstInnings?.curOver && firstInnings.curOver.length > 0) {
        firstOvers.push(firstInnings.curOver);
      }
      
      const secondInningsDone = secondInnings?.done || data.matchCompleted;
      if (secondInningsDone && secondInnings?.curOver && secondInnings.curOver.length > 0) {
        secondOvers.push(secondInnings.curOver);
      }
      
      // Determine maximum number of overs to display
      const maxOvers = Math.max(firstOvers.length, secondOvers.length);
      
      if (maxOvers === 0) {
        document.getElementById('matchSummaryBody').innerHTML = '<tr><td colspan="3" style="text-align:center;color:#94a3b8;padding:20px;font-size:13px;">No overs bowled yet</td></tr>';
        return;
      }
      
      // Build table rows
      let tableHtml = '';
      let firstCumulativeRuns = 0;
      let firstCumulativeWkts = 0;
      let secondCumulativeRuns = 0;
      let secondCumulativeWkts = 0;
      
      for (let i = 0; i < maxOvers; i++) {
        const overNum = i + 1;
        const firstOver = firstOvers[i];
        const secondOver = secondOvers[i];
        
        // Calculate runs/wickets for this over
        const firstStats = firstOver ? overRunsAndWkts(firstOver) : null;
        const secondStats = secondOver ? overRunsAndWkts(secondOver) : null;
        
        // Update cumulative scores
        if (firstStats) {
          firstCumulativeRuns += firstStats.runs;
          firstCumulativeWkts += firstStats.wkts;
        }
        if (secondStats) {
          secondCumulativeRuns += secondStats.runs;
          secondCumulativeWkts += secondStats.wkts;
        }
        
        // Build balls HTML for first innings
        const firstBallsHtml = firstOver ? firstOver.map(sym => {
          const isWicket = /W$/.test(sym) || /\+W$/.test(sym);
          let bgColor = '#3b82f6';
          if (isWicket) bgColor = '#e31d1d';
          else if (sym === 6) bgColor = '#f59e0b';
          else if (sym === 4) bgColor = '#10b981';
          else if (sym === 0) bgColor = '#94a3b8';
          else if (typeof sym === 'string' && (sym.includes('WD') || sym.includes('NB') || sym.includes('B+') || sym.includes('LB+'))) bgColor = '#f59e0b';
          return `<span style="display:inline-block;margin:1px;padding:2px 4px;border-radius:4px;background:${bgColor};color:#fff;font-weight:700;font-size:10px;">${sym}</span>`;
        }).join('') : '<span style="color:#cbd5e1;font-size:11px;">—</span>';
        
        // Build balls HTML for second innings
        const secondBallsHtml = secondOver ? secondOver.map(sym => {
          const isWicket = /W$/.test(sym) || /\+W$/.test(sym);
          let bgColor = '#3b82f6';
          if (isWicket) bgColor = '#e31d1d';
          else if (sym === 6) bgColor = '#f59e0b';
          else if (sym === 4) bgColor = '#10b981';
          else if (sym === 0) bgColor = '#94a3b8';
          else if (typeof sym === 'string' && (sym.includes('WD') || sym.includes('NB') || sym.includes('B+') || sym.includes('LB+'))) bgColor = '#f59e0b';
          return `<span style="display:inline-block;margin:1px;padding:2px 4px;border-radius:4px;background:${bgColor};color:#fff;font-weight:700;font-size:10px;">${sym}</span>`;
        }).join('') : '<span style="color:#cbd5e1;font-size:11px;">—</span>';
        
        tableHtml += `
          <tr style="border-bottom:1px solid #e2e8f0;">
            <td style="padding:6px 2px;text-align:center;font-weight:700;color:#1f2937;font-size:11px;border-right:1px solid #e2e8f0;background:#f1f5f9;vertical-align:top;">${overNum}</td>
            <td style="padding:6px 4px;border-right:1px solid #e2e8f0;background:#fff;vertical-align:top;word-wrap:break-word;">
              ${firstStats ? `<div style="display:flex;align-items:center;justify-content:space-between;font-size:11px;margin-bottom:5px;padding:4px 6px;background:linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);border-radius:6px;border-left:3px solid #3b82f6;">
                <span style="font-weight:700;color:#1e40af;">${firstCumulativeRuns}/${firstCumulativeWkts}</span>
                <span style="display:flex;gap:6px;color:#64748b;font-weight:600;font-size:10px;">
                  <span style="display:inline-flex;align-items:center;gap:2px;background:#fff;padding:2px 5px;border-radius:4px;">\ud83c\udfaf <strong style="color:#059669;">${firstStats.runs}</strong></span>
                  ${firstStats.wkts > 0 ? `<span style="display:inline-flex;align-items:center;gap:2px;background:#fff;padding:2px 5px;border-radius:4px;">\ud83d\udd34 <strong style="color:#dc2626;">${firstStats.wkts}</strong></span>` : ''}
                  ${firstStats.extras > 0 ? `<span style="display:inline-flex;align-items:center;gap:2px;background:#fff;padding:2px 5px;border-radius:4px;">\u2795 <strong style="color:#f59e0b;">${firstStats.extras}</strong></span>` : ''}
                </span>
              </div>` : ''}
              <div style="line-height:1.4;">${firstBallsHtml}</div>
            </td>
            <td style="padding:6px 4px;background:#fff;vertical-align:top;word-wrap:break-word;">
              ${secondStats ? `<div style="display:flex;align-items:center;justify-content:space-between;font-size:11px;margin-bottom:5px;padding:4px 6px;background:linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);border-radius:6px;border-left:3px solid #3b82f6;">
                <span style="font-weight:700;color:#1e40af;">${secondCumulativeRuns}/${secondCumulativeWkts}</span>
                <span style="display:flex;gap:6px;color:#64748b;font-weight:600;font-size:10px;">
                  <span style="display:inline-flex;align-items:center;gap:2px;background:#fff;padding:2px 5px;border-radius:4px;">\ud83c\udfaf <strong style="color:#059669;">${secondStats.runs}</strong></span>
                  ${secondStats.wkts > 0 ? `<span style="display:inline-flex;align-items:center;gap:2px;background:#fff;padding:2px 5px;border-radius:4px;">\ud83d\udd34 <strong style="color:#dc2626;">${secondStats.wkts}</strong></span>` : ''}
                  ${secondStats.extras > 0 ? `<span style="display:inline-flex;align-items:center;gap:2px;background:#fff;padding:2px 5px;border-radius:4px;">\u2795 <strong style="color:#f59e0b;">${secondStats.extras}</strong></span>` : ''}
                </span>
              </div>` : ''}
              <div style="line-height:1.4;">${secondBallsHtml}</div>
            </td>
          </tr>
        `;
      }
      
      document.getElementById('matchSummaryBody').innerHTML = tableHtml;
    }
    
    // Helper to calculate runs/wickets/extras for an over
    function overRunsAndWkts(arr) {
      let runs = 0, wkts = 0, extras = 0;
      arr.forEach(sym => {
        if (typeof sym === 'string') {
          // New format with + signs
          if (/^([0-9]+)\+W$/.test(sym)) { runs += parseInt(sym); wkts += 1; }
          else if (/^W$/.test(sym)) { wkts += 1; }
          else if (/^WD\+([0-9]+)\+W$/.test(sym)) { const extra = 1 + parseInt(sym.match(/^WD\+([0-9]+)\+W$/)[1]); runs += extra; wkts += 1; extras += extra; }
          else if (/^WD\+W$/.test(sym)) { runs += 1; wkts += 1; extras += 1; }
          else if (/^NB\+([0-9]+)\+W$/.test(sym)) { const extra = 1 + parseInt(sym.match(/^NB\+([0-9]+)\+W$/)[1]); runs += extra; wkts += 1; extras += extra; }
          else if (/^NB\+W$/.test(sym)) { runs += 1; wkts += 1; extras += 1; }
          else if (/^B\+([0-9]+)\+W$/.test(sym)) { const extra = parseInt(sym.match(/^B\+([0-9]+)\+W$/)[1]); runs += extra; wkts += 1; extras += extra; }
          else if (/^B\+W$/.test(sym)) { runs += 0; wkts += 1; }
          // Old format (backward compatibility)
          else if (/^([0-9]+)W$/.test(sym)) { runs += parseInt(sym); wkts += 1; }
          else if (/^WD\+([0-9]+)W$/.test(sym)) { const extra = 1 + parseInt(sym.match(/^WD\+([0-9]+)W$/)[1]); runs += extra; wkts += 1; extras += extra; }
          else if (/^WDW$/.test(sym)) { runs += 1; wkts += 1; extras += 1; }
          else if (/^NB\+([0-9]+)W$/.test(sym)) { const extra = 1 + parseInt(sym.match(/^NB\+([0-9]+)W$/)[1]); runs += extra; wkts += 1; extras += extra; }
          else if (/^NBW$/.test(sym)) { runs += 1; wkts += 1; extras += 1; }
          else if (/^B\+([0-9]+)W$/.test(sym)) { const extra = parseInt(sym.match(/^B\+([0-9]+)W$/)[1]); runs += extra; wkts += 1; extras += extra; }
          else if (/^BW$/.test(sym)) { runs += 0; wkts += 1; }
          // Normal balls
          else if (/^[0-9]$/.test(sym)) runs += parseInt(sym);
          else if (/^NB$/.test(sym) || /^WD$/.test(sym)) { runs += 1; extras += 1; }
          else if (/^NB\+([0-9]+)$/.test(sym)) { const extra = 1 + parseInt(sym.match(/^NB\+([0-9]+)$/)[1]); runs += extra; extras += extra; }
          else if (/^WD\+([0-9]+)$/.test(sym)) { const extra = 1 + parseInt(sym.match(/^WD\+([0-9]+)$/)[1]); runs += extra; extras += extra; }
          else if (/^B\+([0-9]+)$/.test(sym)) { const extra = parseInt(sym.match(/^B\+([0-9]+)$/)[1]); runs += extra; extras += extra; }
          else if (/^LB\+([0-9]+)$/.test(sym)) { const extra = parseInt(sym.match(/^LB\+([0-9]+)$/)[1]); runs += extra; extras += extra; }
        }
      });
      return {runs, wkts, extras};
    }
    
    // Share on WhatsApp function
    function shareOnWhatsApp() {
      // Get current match data from the page
      const teamAName = document.getElementById('teamAName').textContent;
      const teamBName = document.getElementById('teamBName').textContent;
      const scoreA = document.getElementById('scoreA').textContent;
      const scoreB = document.getElementById('scoreB').textContent;
      const teamAOvers = document.getElementById('teamAOvers').textContent;
      const teamBOvers = document.getElementById('teamBOvers').textContent;
      
      // Get result if available
      const resultBanner = document.getElementById('result');
      const result = resultBanner && resultBanner.classList.contains('show') ? resultBanner.textContent : '';
      
      // Get tournament name if available
      const tournamentEl = document.getElementById('tournamentTitle');
      const tournament = tournamentEl ? tournamentEl.textContent : '';
      
      // Create share link
      const shareLink = `${window.location.origin}/livescore.html?org=${organizationId}&match=${matchId}`;
      
      // Build message
      let message = `🏏 *CricketBook Live Score* 🏏\n\n`;
      
      if (tournament) {
        message += `🏆 *${tournament}*\n\n`;
      }
      
      message += `*${teamAName}* vs *${teamBName}*\n\n`;
      message += `📊 *Score:*\n`;
      message += `${teamAName}: ${scoreA} ${teamAOvers}\n`;
      message += `${teamBName}: ${scoreB} ${teamBOvers}\n`;
      
      if (result) {
        message += `\n🏆 *Result:* ${result}\n`;
      } else {
        message += `\n🔴 *LIVE NOW!*\n`;
      }
      
      message += `\n👁️ Watch Live: ${shareLink}\n`;
      message += `\n_Powered by CricketBook_`;
      
      // Encode message for URL
      const encodedMessage = encodeURIComponent(message);
      
      // Open WhatsApp with pre-filled message
      const whatsappUrl = `https://wa.me/?text=${encodedMessage}`;
      
      // Open in new window
      window.open(whatsappUrl, '_blank');
    }
    
    // Clean up connections when leaving page
    window.addEventListener('beforeunload', () => {
      console.log('🧹 Cleaning up connections before page unload');
      if (currentMatchRef) {
        currentMatchRef.off();
      }
      if (matchesListenerRef) {
        matchesListenerRef.off();
      }
      if (pollingInterval) {
        clearInterval(pollingInterval);
      }
    });
  </script>

  <!-- Footer -->
  <footer style="text-align:center;padding:24px 0;color:#ffffff;font-size:14px;margin-top:24px;">
    <p style="margin:0 0 8px;">Made with ❤️ for local cricket matches.</p>
    <p style="margin:0 0 8px;opacity:0.9;">© 2026 CricketBook — Realtime Cricket Scoring Tool</p>
    <p style="margin:0;"><a href="https://www.instagram.com/cricketbook.digital/" target="_blank" rel="noopener noreferrer" style="color:white;text-decoration:none;font-weight:600;opacity:0.95;transition:opacity 0.2s;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.95'">📷 Follow us on Instagram</a></p>
  </footer>
  <script>
    // Register Service Worker for PWA (only works on HTTP/HTTPS)
    if ('serviceWorker' in navigator && window.location.protocol !== 'file:') {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/service-worker.js')
          .then(reg => console.log('✅ Service Worker registered:', reg.scope))
          .catch(err => console.log('❌ Service Worker registration failed:', err));
      });
    }
  </script>

</body>
</html>
